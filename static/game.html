<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Infinite Dopamine</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            font-family: 'Roboto', sans-serif;
        }
        #canvas {
            width: 100vw;
            height: 100vh;
            display: block;
        }
        #dialogue {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: none;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        #dialogue-content {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            font-size: 20px;
            font-weight: 400;
            color: #333;
            max-width: 85%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        #dialogue {
            pointer-events: none;
        }
        #dialogue-content, #next-button {
            pointer-events: auto;
        }
        #next-button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #start-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            font-size: 18px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #score {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 24px;
            color: white;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="dialogue">
        <div id="dialogue-content"></div>
        <button id="next-button" style="display: none;">Next</button>
    </div>
    <button id="start-button">Start Guessing</button>
    <div id="score">Score: 0</div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script>
        // Define relationship themes with pastel colors and dialogues
        const themes = [
            { name: "Playful Banter", color: 0xFF6B6B, dialogue: "Tu veux m‚Äôemmener qq part pour me briser psychologiquement avec tes vannes?" },
            { name: "Intellectual Talk", color: 0x6BCBFF, dialogue: "Tellement int√©ressant, on ne sait pas de quoi la majorit√© de l‚Äôunivers est fait" },
            { name: "Affection", color: 0x900C3F, dialogue: "Je t‚Äôaime trop en fait" },
            { name: "Travel Plans", color: 0x6BFF8E, dialogue: "J‚Äôaime bien l‚Äôid√©e de Dublin" },
            { name: "Everyday Life", color: 0xFFF76B, dialogue: "Wa y a une dame qui pleure super fort dans le m√©tro, c‚Äôest dur" },
            { name: "Inside Jokes", color: 0xCB6BFF, dialogue: "sweatshirt" }
        ];

        // Conversation messages with their correct theme indices
        const messages = [
            { text: "Mdr je viens de me faire appeler par Les Jeunes Horizons du 13 üòÇ", theme: 4 }, // Everyday Life
            { text: "Tu sais que y‚Äôa 3 ans les jeunes avec Macron ont essay√© de me d√©baucher pour la campagne", theme: 4 }, // Everyday Life
            { text: "Ok j‚Äôadore avec une appli de messages avec UN seul contact üòç", theme: 0 }, // Playful Banter
            { text: "Do you miss me yet?", theme: 2 }, // Affection
            { text: "Text-bombing you through 3 different apps apparently doesnt increase the chance of getting a response", theme: 0 }, // Playful Banter
            { text: "holy shit... i slept... a lot !", theme: 4 }, // Everyday Life
            { text: "Je veux le debrief d√©taill√© de cette soir√©e au Chope moi", theme: 4 }, // Everyday Life
            { text: "Si √ßa se trouve Claire a organis√© des olympiades", theme: 0 }, // Playful Banter
            { text: "Je viens de me rappeler que t‚Äôavais mang√© tout le donut", theme: 0 }, // Playful Banter
            { text: "Justine after I ate the donut: ‚ÄúMm, he chose war.‚Äù", theme: 0 }, // Playful Banter
            { text: "Je suis trop bien dans ton pull. Je fais un peu un Vis ma vie de Mehdi la moula, jeune start-upper en qu√™te de sensations dans les comedy clubs", theme: 2 }, // Affection
            { text: "Je vais avoir 30 ans, j‚Äôai une hypoth√®que convenable, z√©ro d√©faut √©rectile, et la vie devant moi!", theme: 0 }, // Playful Banter
            { text: "Ch√©rie, je suis pas un bon parti, car chui pas dans le bon parti", theme: 0 }, // Playful Banter
            { text: "√áa part sur Suno direct √ßa", theme: 5 }, // Inside Jokes
            { text: "Je t‚Äôaime", theme: 2 }, // Affection
            { text: "Tu me manques d√©j√†", theme: 2 }, // Affection
            { text: "J‚Äôai l‚Äôimpression d‚Äôetre un hacker dans cette appli", theme: 0 }, // Playful Banter
            { text: "LE LIVREUR DE PHO EST REVENU MEHDI", theme: 5 }, // Inside Jokes
            { text: "This is called dedication to a joke.", theme: 0 }, // Playful Banter
            { text: "You look 19 cause u fun as hell", theme: 2 }, // Affection
            { text: "Plenty of time to have all 5 of your babies", theme: 0 }, // Playful Banter
            { text: "We want them white high IQ", theme: 0 }, // Playful Banter
            { text: "Tu veux boire un caf√© avec Sakina ?", theme: 3 }, // Travel Plans (meeting-related)
            { text: "J‚Äôai dormi dans ton pull comme une adolescente", theme: 2 }, // Affection
            { text: "Je suis archi fatigu√©e- je suis rest√©e chez mes parents du coup", theme: 4 }, // Everyday Life
            { text: "Je vais tenter de me rentrer une petite sieste bient√¥t", theme: 4 }, // Everyday Life
            { text: "Je regarde un reportage super int√©ressant, un The Wire fran√ßais, tu kifferais bcp, le volet social est incr", theme: 1 }, // Intellectual Talk
            { text: "Il a une explication sur les cycles de paup√©risation/gentrification dans les villes super insightful", theme: 1 }, // Intellectual Talk
            { text: "Mais tu sais que les perspectives gaucho ne disent pas que des conneries right?", theme: 1 }, // Intellectual Talk
            { text: "Je vais √©crire 3 sketchs pendant ces 10 prochains jours", theme: 4 }, // Everyday Life
            { text: "Je dois m‚Äôy mettre aussi et tu me motives juste haha", theme: 4 }, // Everyday Life
            { text: "Your merguez is lovely", theme: 0 }, // Playful Banter
            { text: "Je regardais le tableau de Hopper et je pensais √† toi y a 5 min ‚ù§Ô∏è", theme: 2 }, // Affection
            { text: "Our relationship feels like a conversation that started three months ago, and never ended.", theme: 2 } // Affection
        ];

        // Initialize Three.js scene, camera, and renderer
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 5);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x1a1a2e);

        // Create a twinkling starfield
        const starsGeometry = new THREE.BufferGeometry();
        const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.7, sizeAttenuation: true });
        const starsPositions = [];
        for (let i = 0; i < 3000; i++) {
            const x = (Math.random() - 0.5) * 2500;
            const y = (Math.random() - 0.5) * 2500;
            const z = (Math.random() - 0.5) * 2500;
            starsPositions.push(x, y, z);
        }
        starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsPositions, 3));
        const stars = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(stars);

        // Function to create textured faces with text labels
        function createTextTexture(text, color) {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = `#${color.toString(16).padStart(6, '0')}`;
            ctx.fillRect(0, 0, 512, 512);
            const gradient = ctx.createLinearGradient(0, 0, 512, 512);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.2)');
            gradient.addColorStop(1, 'rgba(0, 0, 0, 0.1)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, 512, 512);
            ctx.font = 'bold 60px Roboto';
            ctx.fillStyle = 'white';
            ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
            ctx.shadowOffsetX = 3;
            ctx.shadowOffsetY = 3;
            ctx.shadowBlur = 5;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(text, 256, 256);
            return new THREE.CanvasTexture(canvas);
        }

        // Create materials for each cube face
        const materials = themes.map(theme => new THREE.MeshPhongMaterial({
            map: createTextTexture(theme.name, theme.color),
            shininess: 50
        }));

        // Create and position the cube
        const geometry = new THREE.BoxGeometry(2, 2, 2);
        const cube = new THREE.Mesh(geometry, materials);
        scene.add(cube);
        cube.rotation.set(THREE.Math.degToRad(35), THREE.Math.degToRad(45), 0);

        // Add lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffffff, 1.2, 100);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);
        const spotLight = new THREE.SpotLight(0xffffff, 1.5, 200, Math.PI / 8);
        spotLight.position.set(-5, 10, 5);
        scene.add(spotLight);

        // Set up OrbitControls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.08;
        controls.enableZoom = false;
        controls.enablePan = false;

        // Raycasting for interaction
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        // Pop sound effect
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playPopSound() {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.frequency.value = 600;
            oscillator.type = "square";
            gainNode.gain.value = 0.1;
            oscillator.start();
            setTimeout(() => oscillator.stop(), 100);
        }

        let currentMessage = null;
        let score = 0;

        // Start a new guess
        function startNewGuess() {
            const randomIndex = Math.floor(Math.random() * messages.length);
            currentMessage = messages[randomIndex];
            document.getElementById('dialogue-content').innerText = `Guess the category for this message: "${currentMessage.text}"`;
            document.getElementById('next-button').style.display = 'none';
            const dialogue = document.getElementById('dialogue');
            dialogue.style.display = 'flex';
            setTimeout(() => { dialogue.style.opacity = '1'; }, 10);
        }

        // Handle touch events
        function onTouchStart(event) {
            event.preventDefault();
            const dialogue = document.getElementById('dialogue');
            if (dialogue.style.display === 'flex' && currentMessage === null) {
                dialogue.style.opacity = '0';
                setTimeout(() => { dialogue.style.display = 'none'; }, 300);
            } else {
                const touch = event.touches[0];
                mouse.x = (touch.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(touch.clientY / window.innerHeight) * 2 + 1;
                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObject(cube);
                if (intersects.length > 0) {
                    const materialIndex = intersects[0].face.materialIndex;
                    if (currentMessage !== null) {
                        const dialogueContent = document.getElementById('dialogue-content');
                        if (materialIndex === currentMessage.theme) {
                            score++;
                            document.getElementById('score').innerText = `Score: ${score}`;
                            dialogueContent.innerText = `Correct! It was ${themes[materialIndex].name}`;
                            confetti({
                                particleCount: 100,
                                spread: 70,
                                origin: { x: touch.clientX / window.innerWidth, y: touch.clientY / window.innerHeight }
                            });
                            playPopSound();
                        } else {
                            dialogueContent.innerText = `Incorrect. It was ${themes[currentMessage.theme].name}`;
                        }
                        document.getElementById('next-button').style.display = 'block';
                        currentMessage = null;
                    } else {
                        const theme = themes[materialIndex];
                        document.getElementById('dialogue-content').innerText = theme.dialogue;
                        dialogue.style.display = 'flex';
                        setTimeout(() => { dialogue.style.opacity = '1'; }, 10);
                        playPopSound();
                        confetti({
                            particleCount: 50,
                            spread: 70,
                            origin: { x: touch.clientX / window.innerWidth, y: touch.clientY / window.innerHeight }
                        });
                    }
                }
            }
        }

        document.getElementById('canvas').addEventListener('touchstart', onTouchStart);
        document.getElementById('start-button').addEventListener('click', startNewGuess);
        document.getElementById('next-button').addEventListener('click', () => {
            startNewGuess();
            document.getElementById('next-button').style.display = 'none';
        });

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            starsMaterial.opacity = 0.5 + Math.sin(Date.now() * 0.002) * 0.5;
            renderer.render(scene, camera);
        }
        animate();

        // Handle window resizing
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>